C51 COMPILER V9.57.0.0   MAIN                                                              11/21/2019 22:01:40 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\MDK\install\Core\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\List
                    -ings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <reg52.h>
   2          #include <intrins.h>
   3          #define uchar unsigned char
   4          #define uint unsigned int
   5          #define Hex2Char(x) ((x/10)*10+(x%10)-48)
   6          sbit DAT=P3^0;                  // 74HC164 数据输入
   7          sbit CLK=P3^1;                  // 74HC164 时钟输入
   8          sbit KEY = P3^2;                // 按键端口
   9          uchar show_data;                // 接收数据
  10          uchar number = 0;       // 数字0~9
  11          
  12          /**********************************************************
  13          *  函数名称：精确延时50ms函数 @11.0592MHz
  14          *  日期：2019-10-25
  15          *  姓名：ZhangHJ
  16          *  说明：由STC-ISP自动生成
  17          ***********************************************************/
  18          void Delay50ms()                //@11.0592MHz
  19          {
  20   1              unsigned char i, j, k;
  21   1      
  22   1              _nop_();
  23   1              _nop_();
  24   1              i = 3;
  25   1              j = 26;
  26   1              k = 223;
  27   1              do
  28   1              {
  29   2                      do
  30   2                      {
  31   3                              while (--k);
  32   3                      } while (--j);
  33   2              } while (--i);
  34   1      }
  35          
  36          
  37          
  38          /**********************************************************
  39          *  函数名称：配置串口1
  40          *  日期：2019-11-21
  41          *  姓名：ZhangHJ
  42          *  说明：1. 设置定时器12分频
  43          *                2. 配置定时器T1方式2(8位自动重装)
  44          *                3. 定时器装初值,设置波特率
  45          *                4. 设置波特率倍增位,波特率不加倍
  46          *                5. 设置串行口控制寄存器,8位数据,允许串行接收
  47          *                6. 开启总中断和串口中断
  48          *                7. 定时器T1运行
  49          ***********************************************************/
  50          void UartConfig()
  51          {
  52   1              AUXR &= 0xBF;   // 定时器T1分频12T
  53   1              TMOD = 0x20;    // 定时器1方式2(8位自动重装)
  54   1              TH1 = 0xFD;             // 定时器重装值
C51 COMPILER V9.57.0.0   MAIN                                                              11/21/2019 22:01:40 PAGE 2   

  55   1              TL1 = 0xFD;             // 定时器初值
  56   1              PCON = 0x00;    // 波特率不加倍 0x80加倍(SMOD=1)
  57   1              SCON = 0x50;    // 波特率控制寄存器,8位UART,REN=1
  58   1              EA = 1;                 // 打开总中断
  59   1              ES = 1;                 // 打开串行口中断
  60   1              TR1 = 1;                // 定时器T1运行
  61   1      }
  62          
  63          
  64          
  65          /**********************************************************
  66          *  函数名称：配置外部中断0
  67          *  日期：2019-10-22
  68          *  姓名：ZhangHJ
  69          *  说明：1. 选择为下降沿触发方式(为1代表下降沿触发，为0代表低电平触发)
  70          *                2. 使能外部中断0
  71          *                3. 使能总中断
  72          ***********************************************************/
  73          void configExtInt0()
  74          {
  75   1              IT0 = 1;        //选择为下降沿触发方式(为1代表下降沿触发，为0代表低电平触发)
  76   1              EX0 = 1;        //使能外部中断0
  77   1              EA = 1;         //使能总中断
  78   1      }
  79          
  80          
  81          
  82          /**********************************************************
  83          *  函数名称：外部中断0服务函数
  84          *  日期：2019-11-21
  85          *  姓名：ZhangHJ
  86          *  说明：1. 中断服务函数功能为,使num在0~9之间循环变化
  87          *                2. 发送number的十六进制数值
  88          ***********************************************************/
  89          void extInt0() interrupt 0
  90          {
  91   1              EA = 0;                                                 // 关闭总中断
  92   1              Delay50ms();                                    // 延时防抖
  93   1              if(KEY == 0)
  94   1              {
  95   2                      number ++;
  96   2                      number = number % 10;
  97   2                      SBUF = number+48;
  98   2                      while(!TI);  //等待发送完毕
  99   2                      TI=0;        //清除发送标志位
 100   2              }
 101   1              EA = 1;                                                 // 开启总中断
 102   1      }
 103          
 104          
 105          
 106          // 主函数功能：接收串口发送的数据,并将接收到的数据发送出去
 107          // 注意：STC-ISP需要选择使用外部时钟
 108          void main()
 109          {
 110   1              configExtInt0();
 111   1              UartConfig();   // 配置串口
 112   1      //      P1 &= 0xf0;
 113   1              while(1)
 114   1              {
 115   2      //              SendByte_74HC164();
 116   2      //              delay_ms(200);
C51 COMPILER V9.57.0.0   MAIN                                                              11/21/2019 22:01:40 PAGE 3   

 117   2              }
 118   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    115    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
